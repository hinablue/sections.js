/*! sectionsjs - v0.0.1 - 2013-10-15 | Copyright (c) 2013 Po-Ying Chen <poying.me@gmail.com> */

!function(a,b){"use strict";var c=a.sections={};c.config={className:"section",marginTop:0,interval:200,autoSectionHeight:!0},c.utils={},c.utils.getInlineCSS=function(a){var b=a.getAttribute("style")||"",c=/([^:\s]+)\s*:\s*([^;]+)/g,d={};return b.replace(c,function(a,b,c){d[b]=c.trim()}),d},c.utils.setInlineCSS=function(a,b){var d,e=c.utils.getInlineCSS(a),f=[];for(d in b)b.hasOwnProperty(d)&&(e[d]=b[d]);for(d in e)e.hasOwnProperty(d)&&f.push(d+": "+e[d]);return a.setAttribute("style",f.join("; ")),e},c.events={},c.events.EventEmitter=function(){var a=function(){this.events={}},b=a.prototype.on=function(a,b,c){var d=this.events;return"function"==typeof b&&(b.once=!!c,d[a]||(d[a]=[]),d[a].push(b)),this};a.prototype.addEventListener=b,a.prototype.once=function(a,b){return this.on(a,b,!0)};var c=a.prototype.off=function(a,b){var c=this.events;if("function"==typeof b)for(var d=c[a]||[],e=d.length;e--;)d[e]===b&&d.splice(e,1);else delete c[a];return this};a.prototype.removeEventListener=c;var d=a.prototype.emit=function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this.events[a]||[],d=c.length;d--;)c[d].apply(this,b),c[d].once&&c.splice(d,1);return this};return a.prototype.trigger=d,a}(),c.Section=function(){var a=function(a){c.events.EventEmitter.call(this),this.element=a,this.updatePosition(),this.progress=0};return a.prototype=new c.events.EventEmitter,a.prototype.updatePosition=function(){var a=this.element.getBoundingClientRect();return this.left=a.left,this.right=a.right,this.top=a.top,this.bottom=a.bottom,this},a.prototype.getCSS=function(a){var b=c.utils.getInlineCSS(this.element);return a?b[a]:b},a.prototype.setCSS=function(a){return c.utils.setInlineCSS(this.element,a),this},a.prototype.updateProgress=function(a,b){var c,d=this.getHeight();if(a+b>this.top&&a<=this.top+d){var e=this.top-a;c=100*(e/d),c=c>0?100-c:c}else c=this.top-a>0?0:-100;return this.progress!==c&&(this.progress=c,this.emit("progress",c)),this},a.prototype.getHeight=function(){return this.element.offsetHeight},a}(),c.proto=new c.events.EventEmitter,c.proto.start=function(){return this.__started=!0,this.getSections(),this.updateWindowSize(),this.addScrollEventHandler(),this.getScrollHeight(),this.addWindowResizeHandler(),this.updateProgress(),this.lazyApply(),this},c.proto.getScrollHeight=function(){var a=b.body,c=b.documentElement;return this.scrollHeight=a.scrollHeight||c.scrollHeight||0,this},c.proto.getSections=function(){this.sections=[];var a,d=b.getElementsByClassName(this.config.className)||[],e=d.length;for(a=0;e>a;a+=1)this.sections.push(new c.Section(d[a]));return this},c.proto.addScrollEventHandler=function(){var c=this;return setInterval(function(){var d={x:0,y:0};a.pageYOffset?(d.y=a.pageYOffset,d.x=a.pageXOffset):b.body&&b.body.scrollLeft?(d.y=b.body.scrollTop,d.x=b.body.scrollLeft):b.documentElement&&b.documentElement.scrollLeft&&(d.y=b.documentElement.scrollTop,d.x=b.documentElement.scrollLeft),c.top=d.y,c.left=d.x,c.checkCurrentSection(),c.updateProgress()},this.config.interval),this},c.proto.updateWindowSize=function(){var c=b.documentElement,d=b.body,e=a.innerWidth||c.clientWidth||d.clientWidth,f=a.innerHeight||c.clientHeight||d.clientHeight;return this.width=e,this.height=f,this.config.autoSectionHeight&&this.each(function(a,b){b.setCSS({height:f+"px"}),b.updatePosition()}),this},c.proto.addWindowResizeHandler=function(){var b=this,c=function(){b.updateWindowSize()};return a.addEventListener("resize",c),c(),this},c.proto.checkCurrentSection=function(){var a=this,b=0|this.__currentIndex;return this.each(function(c,d){if(a.top>d.top&&a.top<=d.top+d.getHeight()&&c!==b){a.__currentIndex=c;var e=a.get(b),f=a.get(c);return a.emit("changed",f,e),e.emit("scrollOut",f>e?1:-1),f.emit("scrollIn",e>f?1:-1),!1}}),this},c.proto.updateProgress=function(){var a=this.last(),b=this,c=100*(this.top/(this.scrollHeight-a.getHeight()));return this.progress!==c&&(this.progress=c,this.emit("progress",c)),this.each(function(a,c){c.updateProgress(b.top,b.height)}),this},c.proto.lazyApply=function(){for(var a=this.__lazyApply,b=a.length;b--;)a[b]();return this},c.proto.current=function(){return this.get(this.currentIndex())},c.proto.last=function(){return this.get(this.sections.length-1)},c.proto.first=function(){return this.get(0)},c.proto.currentIndex=function(){return 0|this.__currentIndex},c.proto.get=function(a){return this.sections[a]||null},c.proto.section=function(a,b){if(this.__started){if("function"==typeof b){switch(a){case"first":a=0;break;case"last":a=this.sections.length-1;break;default:a=0|a}var c=this.get(a);c&&b.call(c,c)}}else{var d=this;this.__lazyApply.push(function(){d.section(a,b)})}return this},c.proto.each=function(a){var b,c=this.sections||[],d=c.length;for(b=0;d>b&&a.call(c[b],b,c[b])!==!1;b+=1);return this},c.Sections=function(a){c.events.EventEmitter.call(this),a=a||{};var b,d=c.config;for(b in d)d.hasOwnProperty(b)&&!a.hasOwnProperty(b)&&(a[b]=d[b]);this.__started=!1,this.__currentIndex=0,this.config=a,this.width=0,this.height=0,this.top=0,this.left=0,this.__lazyApply=[]},c.Sections.prototype=c.proto,c.create=function(a){return new c.Sections(a)}}(this,this.document);
//# sourceMappingURL=dist/sectionsjs-0.0.1.map